% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/LLM_parallel_utils.R
\name{call_llm_experiments}
\alias{call_llm_experiments}
\title{Call LLM API with Experimental Metadata}
\usage{
call_llm_experiments(
  experiments,
  tries = 10,
  wait_seconds = 2,
  backoff_factor = 2,
  verbose = FALSE,
  json = FALSE,
  memoize = FALSE,
  max_workers = NULL,
  progress = FALSE
)
}
\arguments{
\item{experiments}{A list where each element represents one experiment. Each element
must contain 'config' and 'messages', and can contain additional named elements
that will be included as metadata columns in the results.}

\item{tries}{Integer. Number of retries for each call. Default is 10.}

\item{wait_seconds}{Numeric. Initial wait time (seconds) before retry. Default is 2.}

\item{backoff_factor}{Numeric. Multiplier for wait time after each failure. Default is 2.}

\item{verbose}{Logical. If TRUE, prints progress and debug information.}

\item{json}{Logical. If TRUE, returns raw JSON responses.}

\item{memoize}{Logical. If TRUE, enables caching for identical requests.}

\item{max_workers}{Integer. Maximum number of parallel workers. If NULL, auto-detects.}

\item{progress}{Logical. If TRUE, shows progress bar.}
}
\value{
A tibble with API results plus any metadata columns from the experiments.
  The 'pair_index' column shows the position in the input list for debugging.
}
\description{
An enhanced version of call_llm_par() that allows attaching metadata to each experiment.
This eliminates the need to manually track experiment indices and join metadata afterward.
}
\details{
This function accepts experiments in two formats:

\strong{Simple format} (backward compatible with call_llm_par):
\preformatted{
list(config = my_config, messages = my_messages)
}

\strong{Enhanced format with metadata:}
\preformatted{
list(config = my_config, messages = my_messages,
     condition = "treatment", repetition = 1, model_type = "large")
}

Any named elements beyond 'config' and 'messages' are treated as metadata
and included as columns in the results tibble. This eliminates the need to
manually track indices and join metadata afterward.
}
\examples{
\dontrun{
  # Enhanced usage with metadata
  experiments <- list(
    list(config = config1, messages = messages_control,
         condition = "control", repetition = 1, model_size = "small"),
    list(config = config1, messages = messages_treatment,
         condition = "treatment", repetition = 1, model_size = "small"),
    list(config = config2, messages = messages_control,
         condition = "control", repetition = 1, model_size = "large")
  )

  setup_llm_parallel(workers = 4)
  results <- call_llm_experiments(experiments, progress = TRUE)
  reset_llm_parallel()

  # Results include metadata columns automatically - no manual joining needed
  print(results)

  # Direct analysis with metadata
  results \%>\% group_by(condition, model_size) \%>\%
    summarise(mean_rating = mean(as.numeric(response_text), na.rm = TRUE))
}
}
