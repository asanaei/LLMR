<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Generate Embeddings in Batches — get_batched_embeddings • LLMR</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Generate Embeddings in Batches — get_batched_embeddings"><meta name="description" content="A wrapper function that processes a list of texts in batches to generate embeddings,
avoiding rate limits. This function calls call_llm_robust for each
batch and stitches the results together and parses them (using parse_embeddings) to
return a numeric matrix."><meta property="og:description" content="A wrapper function that processes a list of texts in batches to generate embeddings,
avoiding rate limits. This function calls call_llm_robust for each
batch and stitches the results together and parses them (using parse_embeddings) to
return a numeric matrix."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">LLMR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.6.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/asanaei/LLMR"><span class="fa fab fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Generate Embeddings in Batches</h1>
      <small class="dont-index">Source: <a href="https://github.com/asanaei/LLMR/blob/main/R/LLMR.R" class="external-link"><code>R/LLMR.R</code></a></small>
      <div class="d-none name"><code>get_batched_embeddings.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>A wrapper function that processes a list of texts in batches to generate embeddings,
avoiding rate limits. This function calls <code><a href="call_llm_robust.html">call_llm_robust</a></code> for each
batch and stitches the results together and parses them (using <code>parse_embeddings</code>) to
return a numeric matrix.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">get_batched_embeddings</span><span class="op">(</span><span class="va">texts</span>, <span class="va">embed_config</span>, batch_size <span class="op">=</span> <span class="fl">50</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-texts">texts<a class="anchor" aria-label="anchor" href="#arg-texts"></a></dt>
<dd><p>Character vector of texts to embed. If named, the names will be
used as row names in the output matrix.</p></dd>


<dt id="arg-embed-config">embed_config<a class="anchor" aria-label="anchor" href="#arg-embed-config"></a></dt>
<dd><p>An <code>llm_config</code> object configured for embeddings.</p></dd>


<dt id="arg-batch-size">batch_size<a class="anchor" aria-label="anchor" href="#arg-batch-size"></a></dt>
<dd><p>Integer. Number of texts to process in each batch. Default is 50.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical. If TRUE, prints progress messages. Default is TRUE.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A numeric matrix where each row is an embedding vector for the corresponding text.
If embedding fails for certain texts, those rows will be filled with NA values.
The matrix will always have the same number of rows as the input texts.
Returns NULL if no embeddings were successfully generated.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="llm_config.html">llm_config</a></code> to create the embedding configuration.
<code><a href="parse_embeddings.html">parse_embeddings</a></code> to convert the raw response to a numeric matrix.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span>
<span>  <span class="co"># Basic usage</span></span>
<span>  <span class="va">texts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Hello world"</span>, <span class="st">"How are you?"</span>, <span class="st">"Machine learning is great"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">texts</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"greeting"</span>, <span class="st">"question"</span>, <span class="st">"statement"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">embed_cfg</span> <span class="op">&lt;-</span> <span class="fu"><a href="llm_config.html">llm_config</a></span><span class="op">(</span></span>
<span>    provider <span class="op">=</span> <span class="st">"voyage"</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"voyage-large-2-instruct"</span>,</span>
<span>    embedding <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    api_key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"VOYAGE_API_KEY"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="va">embeddings</span> <span class="op">&lt;-</span> <span class="fu">get_batched_embeddings</span><span class="op">(</span></span>
<span>    texts <span class="op">=</span> <span class="va">texts</span>,</span>
<span>    embed_config <span class="op">=</span> <span class="va">embed_cfg</span>,</span>
<span>    batch_size <span class="op">=</span> <span class="fl">2</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span> <span class="co"># }</span></span></code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ali Sanaei.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

