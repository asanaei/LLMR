<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Small experiment with LLMR • LLMR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Small experiment with LLMR">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">LLMR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.6.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/asanaei/LLMR"><span class="fa fab fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Small experiment with LLMR</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/asanaei/LLMR/blob/main/vignettes/experiments.Rmd" class="external-link"><code>vignettes/experiments.Rmd</code></a></small>
      <div class="d-none name"><code>experiments.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/knitr/man/opts_chunk.html" class="external-link">opts_chunk</a></span><span class="op">$</span><span class="fu">set</span><span class="op">(</span></span>
<span>  collapse <span class="op">=</span> <span class="cn">TRUE</span>, comment <span class="op">=</span> <span class="st">"#&gt;"</span>,</span>
<span>  eval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"LLMR_RUN_VIGNETTES"</span>, <span class="st">"false"</span><span class="op">)</span><span class="op">)</span>, <span class="st">"true"</span><span class="op">)</span> <span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This vignette demonstrates:</p>
<ol style="list-style-type: decimal">
<li>Building factorial experiment designs with
<code><a href="../reference/build_factorial_experiments.html">build_factorial_experiments()</a></code>
</li>
<li>Running experiments in parallel with
<code><a href="../reference/call_llm_par.html">call_llm_par()</a></code>
</li>
<li>Comparing unstructured vs. structured output across providers</li>
</ol>
<p>The workflow is: <strong>design → parallel execution →
analysis</strong></p>
<p>We will compare three configurations on two prompts, once
unstructured and once with structured output. In choosing models, note
that at the time of writing this vignette, Gemini models are not
guaranteeing the schema output and is more likely to run into
trouble.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/asanaei/LLMR" class="external-link">LLMR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="va">cfg_openai</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/llm_config.html">llm_config</a></span><span class="op">(</span><span class="st">"openai"</span>,   <span class="st">"gpt-5-nano"</span><span class="op">)</span></span>
<span><span class="va">cfg_cld</span>    <span class="op">&lt;-</span> <span class="fu"><a href="../reference/llm_config.html">llm_config</a></span><span class="op">(</span><span class="st">"anthropic"</span>,<span class="st">"claude-sonnet-4-20250514"</span>, max_tokens <span class="op">=</span> <span class="fl">512</span><span class="op">)</span></span>
<span><span class="va">cfg_gem</span>    <span class="op">&lt;-</span> <span class="fu"><a href="../reference/llm_config.html">llm_config</a></span><span class="op">(</span><span class="st">"groq"</span>,     <span class="st">"openai/gpt-oss-20b"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="build-a-factorial-design">Build a factorial design<a class="anchor" aria-label="anchor" href="#build-a-factorial-design"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">experiments</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_factorial_experiments.html">build_factorial_experiments</a></span><span class="op">(</span></span>
<span>  configs       <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">cfg_openai</span>, <span class="va">cfg_cld</span>, <span class="va">cfg_gem</span><span class="op">)</span>,</span>
<span>  user_prompts  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Summarize in one sentence: The Apollo program."</span>,</span>
<span>                    <span class="st">"List two benefits of green tea."</span><span class="op">)</span>,</span>
<span>  system_prompts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Be concise."</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">experiments</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="run-unstructured">Run unstructured<a class="anchor" aria-label="anchor" href="#run-unstructured"></a>
</h2>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/setup_llm_parallel.html">setup_llm_parallel</a></span><span class="op">(</span>workers <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">res_unstructured</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/call_llm_par.html">call_llm_par</a></span><span class="op">(</span><span class="va">experiments</span>, progress <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/reset_llm_parallel.html">reset_llm_parallel</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">res_unstructured</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">provider</span>, <span class="va">model</span>, <span class="va">user_prompt_label</span>, <span class="va">response_text</span>, <span class="va">finish_reason</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><strong>Understanding the results:</strong></p>
<p>The <code>finish_reason</code> column shows why each response
ended:</p>
<ul>
<li>
<code>"stop"</code>: normal completion</li>
<li>
<code>"length"</code>: hit token limit (increase
<code>max_tokens</code>)</li>
<li>
<code>"filter"</code>: content filter triggered</li>
</ul>
<p>The <code>user_prompt_label</code> helps track which experimental
condition produced each response.</p>
</div>
<div class="section level2">
<h2 id="structured-version">Structured version<a class="anchor" aria-label="anchor" href="#structured-version"></a>
</h2>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">schema</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  type <span class="op">=</span> <span class="st">"object"</span>,</span>
<span>  properties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    answer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"string"</span><span class="op">)</span>,</span>
<span>    keywords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"array"</span>, items <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"string"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  required <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"answer"</span>,<span class="st">"keywords"</span><span class="op">)</span>,</span>
<span>  additionalProperties <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">experiments2</span> <span class="op">&lt;-</span> <span class="va">experiments</span></span>
<span><span class="va">experiments2</span><span class="op">$</span><span class="va">config</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">experiments2</span><span class="op">$</span><span class="va">config</span>, <span class="va">enable_structured_output</span>, schema <span class="op">=</span> <span class="va">schema</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/setup_llm_parallel.html">setup_llm_parallel</a></span><span class="op">(</span>workers <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">res_structured</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/call_llm_par_structured.html">call_llm_par_structured</a></span><span class="op">(</span><span class="va">experiments2</span> , .fields <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"answer"</span>,<span class="st">"keywords"</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="fu"><a href="../reference/reset_llm_parallel.html">reset_llm_parallel</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">res_structured</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">provider</span>, <span class="va">model</span>, <span class="va">user_prompt_label</span>, <span class="va">structured_ok</span>, <span class="va">answer</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ali Sanaei.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
